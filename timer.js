document.addEventListener("DOMContentLoaded", () => {
  // 1. Recuperar datos
  const userName   = localStorage.getItem("userName")   || "Koala";
  const focusMins  = parseInt(localStorage.getItem("focusMins"),10) || 25;
  const restMins   = parseInt(localStorage.getItem("restMins"),10) || 5;
  const categories = JSON.parse(localStorage.getItem("categories") || "[]");

  // 2. Elementos del DOM
  const nameSpan    = document.getElementById("nombre-usuario");
  const startBtn    = document.getElementById("start-focus");
  const introSect   = document.getElementById("focus-start");
  const focusSect   = document.getElementById("focus");
  const timerDisp   = document.getElementById("timer-display");
  const maskRect    = document.getElementById("mask-rect");
  const playBtn     = document.getElementById("play");
  const pauseBtn    = document.getElementById("pause");
  const resetBtn    = document.getElementById("reset");
  const popupLogro  = document.getElementById("popup-logro");
  const popupCats   = document.getElementById("popup-cats");
  const catsList    = document.getElementById("cats-list");
  const nameSample  = document.getElementById("name-sample");
  const gotoPrompt  = document.getElementById("goto-prompt");
  const promptSect  = document.getElementById("prompt");
  const anotherIdea = document.getElementById("another-idea");
  const promptText  = document.getElementById("prompt-text");
  const startActivityBtn = document.getElementById("start-activity");
  const body = document.body;

  // 3. Inicializar pantalla
  nameSpan.textContent = userName;
  let duration = focusMins * 60;
  let remaining = duration;
  let isRestTimer = false;

  gsap.set(maskRect, { attr: { y: 300 } });
  // 4. GSAP: animar la máscara de y=0 → y=300 (llenado de abajo a arriba)
  const fillAnim = gsap.timeline({ paused: true })
  .to(maskRect, {
    attr: { y: 0 },           
    duration: duration,
    ease: "none"
  });

  // 5. Formateo mm:ss
  function fmt(sec){
    const m = String(Math.floor(sec/60)).padStart(2,"0");
    const s = String(sec%60).padStart(2,"0");
    return `${m}:${s}`;
  }
  function update(){ timerDisp.textContent = fmt(remaining); }

  // Function to update visual mode
  function updateVisualMode(isRest, isPaused = false) {
    const modeText = document.querySelector("#focus p");
    const svgIcon = document.querySelector("#focus .circle-content svg");

    if (isPaused) {
      // Pause mode colors with GSAP animation
      gsap.to(body, {
        background: "linear-gradient(180deg, var(--pausa-bg-1) 0%, var(--pausa-bg-2) 50%, var(--pausa-bg-3) 100%)",
        duration: 0.5,
        ease: "power2.inOut"
      });

      // Update circle gradient with animation
      const gradient = document.querySelector("#gradient");
      gsap.to(gradient, {
        innerHTML: `
          <stop offset="0%" stop-color="#0D08C7"/>
          <stop offset="50%" stop-color="#48A4F1"/>
          <stop offset="100%" stop-color="#E4BAFF"/>
        `,
        duration: 0.5,
        ease: "power2.inOut"
      });

      gsap.to(timerDisp, {
        color: "#0D08C7",
        duration: 0.5,
        ease: "power2.inOut"
      });

      gsap.to(".ring-bg", {
        stroke: "#0D08C7",
        duration: 0.5,
        ease: "power2.inOut"
      });

      // Update mode text with fade animation
      gsap.to(modeText, {
        opacity: 0,
        duration: 0.25,
        ease: "power2.inOut",
        onComplete: () => {
          modeText.textContent = "Tiempo pausado";
          gsap.to(modeText, {
            opacity: 1,
            duration: 0.25,
            ease: "power2.inOut"
          });
        }
      });
    } else if (isRest) {
      // Koala mode colors with GSAP animation
      gsap.to(body, {
        background: "linear-gradient(180deg, #1F5F50 0%, #E1F3C1 50%, #E1F3C1 100%)",
        duration: 0.5,
        ease: "power2.inOut"
      });

      // Update circle gradient with animation
      const gradient = document.querySelector("#gradient");
      gsap.to(gradient, {
        innerHTML: `
          <stop offset="0%" stop-color="#E96559"/>
          <stop offset="50%" stop-color="#EA8727"/>
          <stop offset="100%" stop-color="#DFF1BE"/>
        `,
        duration: 0.5,
        ease: "power2.inOut"
      });

      gsap.to(timerDisp, {
        color: "#1F5F50",
        duration: 0.5,
        ease: "power2.inOut"
      });

      gsap.to(".ring-bg", {
        stroke: "#1F5F50",
        duration: 0.5,
        ease: "power2.inOut"
      });

      // Update mode text with fade animation
      gsap.to(modeText, {
        opacity: 0,
        duration: 0.25,
        ease: "power2.inOut",
        onComplete: () => {
          modeText.textContent = "Tiempo de descanso";
          gsap.to(modeText, {
            opacity: 1,
            duration: 0.25,
            ease: "power2.inOut"
          });
        }
      });

      // Update SVG icon for koala mode
      gsap.to(svgIcon, {
        opacity: 0,
        duration: 0.25,
        ease: "power2.inOut",
        onComplete: () => {
          svgIcon.innerHTML = ` <svg width="115" height="139" viewBox="0 0 155 139" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M51.3838 11.2812C57.1872 9.85992 62.4822 11.2472 63.292 11.4775C64.1617 11.7249 65.9678 12.4703 67.8721 13.8115C69.7836 15.1578 71.8558 17.1486 73.1592 19.9131C73.5189 20.6761 73.716 21.467 73.8389 22.1064C76.8991 20.4436 82.3776 17.7515 87.998 17.0322L88.542 16.9688C94.4198 16.3536 98.5276 16.7473 101.66 17.4385C103.221 17.7829 104.524 18.1974 105.656 18.583C105.934 18.6774 106.197 18.7691 106.449 18.8564C107.246 19.1325 107.932 19.3698 108.601 19.5488C108.737 19.5852 108.86 19.6463 108.966 19.7256C111.844 15.3072 117.703 10.6724 128.004 10.7988L128.845 10.8223C137.44 11.1953 143.137 15.6335 145.974 21.3838C148.873 27.2604 148.769 34.475 145.824 39.9922L145.456 40.665C141.625 47.4787 137.087 50.071 134.211 50.6367C134.244 50.7699 134.278 50.9069 134.313 51.0479C134.401 51.3999 134.496 51.7776 134.591 52.1875C134.826 53.2019 135.046 54.3443 135.046 55.4365L135.035 56.373C134.977 58.6262 134.656 61.349 133.238 64.377C136.453 66.2998 141.521 69.7412 145.552 75.6719C148.303 79.7208 152.261 88.0361 154.053 97.0234C155.838 105.978 155.531 115.917 149.314 122.885C143.33 129.591 137.833 133.057 132.125 134.958C126.965 136.676 121.67 137.097 115.87 137.558C115.312 137.602 114.749 137.646 114.181 137.692C107.633 138.226 102.953 138.132 99.4971 137.322C95.9782 136.497 93.7123 134.925 92.0518 132.566C91.7443 132.13 91.4005 131.406 91.0645 130.544C90.7582 129.758 90.4359 128.799 90.1328 127.718C88.7738 129.9 86.6407 132.849 84.3506 134.639C82.3406 136.209 78.8692 137.554 74.9551 137.743C71.01 137.933 66.5331 136.952 62.5732 133.758C62.2867 133.527 62.0154 133.283 61.7598 133.029C60.6833 133.53 58.9018 134.149 56.873 134.293C55.3335 134.402 52.0217 134.578 48.4121 133.04C44.88 131.535 41.1774 128.44 38.5283 122.33L38.2754 121.729C34.3614 112.163 36.9251 107.124 39.7588 105.537C39.7057 105.408 39.6541 105.278 39.6045 105.148L39.46 104.758C38.8082 102.92 38.4827 101.015 38.4893 99.2695L38.4951 98.9229C38.5454 97.2192 38.925 95.5929 39.7344 94.3682L39.9014 94.1289C40.5883 93.202 41.3836 92.4275 42.2148 91.7842C40.57 90.8532 39.6609 89.0909 39.1621 87.5537L39.0684 87.249C38.7421 86.1488 38.5785 85.0747 38.4961 84.2744C37.8786 84.418 37.0847 84.5453 36.1875 84.5527C34.0395 84.5705 31.299 83.8968 29.0371 81.1982C24.494 75.7778 25.355 68.6501 29.8965 63.624L30.3477 63.1445C34.8331 58.5564 42.4657 55.9103 51.9766 57.9053C51.8482 57.4113 51.7315 56.8605 51.6377 56.2852L51.5518 55.7031C51.4553 54.9626 51.4008 54.1823 51.4209 53.4326L51.4346 53.1133C51.4542 52.7686 51.4918 52.4191 51.5547 52.0771C48.1896 51.4663 43.9258 49.3713 40.6963 45.8418C37.091 41.9015 34.7613 36.1578 36.3496 28.7051L36.5156 27.9785C37.7541 22.8986 39.7849 19.2204 42.2334 16.5938L42.7285 16.082C45.2308 13.5944 48.0797 12.1806 50.834 11.4238L51.3838 11.2812ZM62.7041 13.5215C62.0152 13.3255 57.1546 12.0574 51.8945 13.3457C49.2845 13.985 46.5887 15.2502 44.2402 17.585C41.8919 19.9196 39.8379 23.3764 38.5938 28.4795C36.8697 35.5514 38.9982 40.8272 42.2773 44.4111C45.6072 48.0504 50.1115 49.9301 53.0205 50.123C53.6096 50.1621 54.0559 50.6692 54.0166 51.2549C54.006 51.4126 53.9608 51.56 53.8896 51.6904C53.7227 52.0384 53.6067 52.5593 53.5684 53.2334C53.5297 53.9125 53.5734 54.6739 53.6719 55.4297C53.7701 56.1833 53.9207 56.9089 54.084 57.5107C54.2017 57.9447 54.3172 58.281 54.4121 58.5078C54.5967 58.5603 54.7819 58.6149 54.9678 58.6709C63.6718 61.2932 71.1098 66.9542 76.8516 72.9014C77.1541 73.2148 77.4526 73.5288 77.7461 73.8438C77.7612 73.8402 77.7763 73.8375 77.791 73.834L79.8662 71.3574L80.4629 73.1367C80.4694 73.1498 80.4834 73.1772 80.5078 73.2139C80.5633 73.2974 80.6732 73.4351 80.8691 73.5791C81.2222 73.8385 81.9554 74.1901 83.3779 74.1553L83.6719 74.1436C85.1326 74.0581 85.9606 73.7428 86.4473 73.4326L86.6357 73.3008C86.9431 73.0644 87.1195 72.8207 87.2744 72.5547L87.4268 72.2803C87.4508 72.2359 87.4749 72.1904 87.5 72.1445C87.7827 71.6293 88.4319 71.4397 88.9502 71.7207C89.4684 72.0017 89.6595 72.6469 89.377 73.1621C89.3582 73.1963 89.3381 73.2356 89.3154 73.2783C89.1105 73.6649 88.7338 74.3747 87.9434 74.9824C87.0588 75.6624 85.7631 76.1497 83.7979 76.2646C81.7806 76.3826 80.4513 75.9147 79.5986 75.2881C79.5472 75.2503 79.4975 75.2121 79.4502 75.1738L79.209 75.4619C83.6803 80.5506 86.9326 85.6239 88.6963 89.0723C95.5865 88.099 102.765 84.6924 105.64 83.0039C106.148 82.7053 106.804 82.8727 107.104 83.3779C107.405 83.8833 107.236 84.5354 106.728 84.834C103.529 86.7132 95.2175 90.6539 87.4668 91.3545C85.8196 91.5034 84.3333 91.6182 82.9893 91.7227C80.4314 91.9214 78.3865 92.0812 76.7197 92.3545C74.1934 92.7688 72.9375 93.3954 72.2334 94.4844C71.1062 96.2281 71.4413 97.5694 71.8535 98.249C72.0128 98.5117 72.2081 98.6705 72.3369 98.752C74.0575 99.8405 75.8477 98.9946 77.3418 97.9336C77.8222 97.5926 78.4899 97.7031 78.833 98.1807C79.1758 98.6583 79.0643 99.322 78.584 99.6631C77.0862 100.727 74.1766 102.428 71.1973 100.55C70.9284 101.264 70.7278 102.235 70.8945 103.312C71.1304 104.837 71.7659 105.473 72.4287 105.766C73.0872 106.056 73.9604 106.09 74.9482 105.922L75.3789 105.838C76.0248 105.695 76.6828 105.468 77.2764 105.218L77.8447 104.962C78.0242 104.876 78.1915 104.791 78.3428 104.709L78.7471 104.477L79.0293 104.291C79.0978 104.241 79.1272 104.214 79.1309 104.211C79.5483 103.796 80.2252 103.796 80.6426 104.211C81.06 104.626 81.06 105.299 80.6426 105.714C80.4442 105.911 80.1558 106.11 79.8701 106.285C79.5642 106.473 79.1904 106.676 78.7744 106.876C77.9469 107.273 76.9057 107.678 75.8428 107.913C75.2836 108.037 74.6836 108.126 74.0752 108.146C73.9199 108.489 73.8105 108.977 73.9072 109.49C74.0184 110.08 74.4338 110.874 75.7734 111.594C76.3619 111.91 77.3328 112.138 78.6123 112.231C79.7092 112.311 80.9555 112.288 82.2344 112.176L82.7842 112.122C85.7705 111.804 88.6247 111.051 90.0264 110.215C90.1491 110.142 90.2809 110.096 90.4141 110.076C90.4802 109.94 90.5483 109.804 90.6191 109.67L90.8389 109.271C92.3877 106.578 94.9177 104.491 98.7432 103.582L99.1182 103.498C102.277 102.825 104.947 103.021 107.176 103.851C107.695 104.044 108.186 104.27 108.65 104.524L109.105 104.788C109.125 104.783 109.146 104.778 109.167 104.773L109.495 104.703C111.32 104.317 113.572 103.841 116.276 102.575L116.823 102.312C118.461 101.497 119.631 100.777 120.613 100.014L121.024 99.6836C122.099 98.7888 123.013 97.7847 124.182 96.4111C124.563 95.9631 125.238 95.907 125.688 96.2861C126.139 96.6653 126.195 97.3361 125.813 97.7842L124.953 98.7783C124.112 99.7279 123.314 100.55 122.396 101.313C121.167 102.337 119.755 103.231 117.779 104.213C115.244 105.473 113.045 106.087 111.265 106.494C111.677 106.906 112.057 107.344 112.405 107.8C114.96 111.139 115.905 115.522 116.017 118.526C116.038 119.113 115.578 119.606 114.988 119.628C114.398 119.65 113.903 119.192 113.881 118.605C113.779 115.871 112.906 111.964 110.704 109.086C109.616 107.663 108.215 106.507 106.427 105.842C104.846 105.253 102.904 105.027 100.521 105.399L101.259 111.64C101.328 112.223 100.909 112.751 100.322 112.819C99.7361 112.888 99.2049 112.471 99.1357 111.889L98.4238 105.871C95.6382 106.725 93.8401 108.336 92.6953 110.327C91.3773 112.62 90.8833 115.494 90.9014 118.457C90.9194 121.41 91.4447 124.365 92.082 126.746C92.4001 127.934 92.7438 128.968 93.0586 129.775L93.29 130.342C93.5097 130.85 93.6895 131.185 93.8037 131.348C95.1367 133.241 96.9334 134.538 99.9883 135.254C102.912 135.939 106.966 136.086 112.812 135.666L114.006 135.574L115.658 135.441C121.148 135.004 125.914 134.624 130.525 133.234L131.445 132.942C136.582 131.232 141.615 128.146 147.175 122.071L147.715 121.475C153.257 115.263 153.697 106.178 151.955 97.4375C150.219 88.7297 146.373 80.678 143.78 76.8623C140.056 71.3818 135.377 68.149 132.275 66.2812C130.424 69.6581 127.566 72.5949 124.561 74.7861C124.114 75.1113 123.499 75.0415 123.136 74.6416L123.066 74.5576C122.717 74.0843 122.821 73.4194 123.297 73.0723C126.207 70.9507 128.898 68.1283 130.555 64.9717L130.872 64.3359C130.879 64.3211 130.887 64.3065 130.895 64.292C132.701 60.899 132.908 57.9104 132.908 55.4365C132.908 54.5964 132.736 53.6482 132.508 52.666C132.433 52.3426 132.348 52.003 132.264 51.6641C132.108 51.0372 131.951 50.411 131.855 49.8877C131.798 49.5715 131.887 49.2462 132.099 49.0029C132.31 48.7597 132.62 48.6241 132.943 48.6348C134.536 48.6874 139.606 47.1088 143.936 38.9961C146.55 34.098 146.66 27.6029 144.054 22.3203C141.477 17.0971 136.229 13.0262 127.978 12.9248C114.696 12.7618 109.774 21.0879 108.939 25.0459L108.912 25.1514C108.748 25.6646 108.215 25.9811 107.674 25.8682C107.096 25.7476 106.727 25.1838 106.848 24.6094C107.036 23.7153 107.386 22.6727 107.922 21.5684C107.208 21.3711 106.463 21.1129 105.692 20.8457C105.452 20.7623 105.209 20.6773 104.964 20.5938C103.865 20.2196 102.646 19.8336 101.196 19.5137C98.307 18.8762 94.4327 18.4899 88.7656 19.083C82.515 19.7372 76.2223 23.1942 73.5742 24.6885C73.2963 24.8452 72.9624 24.8696 72.6641 24.7559C72.4028 24.6562 72.1923 24.4597 72.0762 24.21L72.0322 24.0996C71.9977 23.9966 71.9703 23.8765 71.9473 23.7578L71.8906 23.4229L71.8887 23.4102L71.8672 23.2744L71.7598 22.6152C71.6523 22.0285 71.4938 21.3875 71.2236 20.8145C70.1221 18.4784 68.3462 16.75 66.6367 15.5459C64.9198 14.3367 63.331 13.6998 62.7041 13.5215ZM54.3486 60.7051C44.083 57.6123 36.1808 60.2276 31.8809 64.626C27.5655 69.0403 26.8174 75.2298 30.6797 79.8379C32.3352 81.8129 34.2577 82.373 35.8555 82.4238L36.1699 82.4268C36.7997 82.4215 37.3697 82.3415 37.8359 82.2432L38.2656 82.1406C38.3956 82.1061 38.5118 82.0717 38.6123 82.04L38.8662 81.9551L39.0137 81.8984C39.0289 81.8923 39.0396 81.888 39.0449 81.8857H39.0459L39.0479 81.8848L39.0576 81.8809C39.5841 81.4184 40.3241 80.8828 41.2002 80.4336L41.584 80.2471C42.841 79.6673 44.4286 79.251 46.0898 79.5605C46.6701 79.6687 47.0521 80.2239 46.9434 80.8008L46.918 80.9072C46.7647 81.4237 46.2401 81.7508 45.6963 81.6494C44.6212 81.449 43.5006 81.7061 42.4844 82.1748C41.6939 82.5394 41.023 83.0072 40.5684 83.3916C40.579 83.5672 40.595 83.78 40.6191 84.0205C40.6919 84.7434 40.8368 85.6964 41.1191 86.6484C41.7119 88.6466 42.7424 90.1488 44.4883 90.2998L44.5781 90.3115C45.7208 89.7453 46.8091 89.3886 47.6641 89.1904C47.7602 89.1287 47.8682 89.0809 47.9854 89.0518C50.2659 88.4849 52.1992 88.5154 53.8115 89.0811C55.4358 89.651 56.6298 90.7283 57.4844 92.0635C57.5019 92.0909 57.5185 92.1191 57.5332 92.1475C57.992 92.2923 58.4335 92.5462 58.835 92.9453C59.9598 94.0637 60.5809 95.5214 60.916 96.8174C61.1746 97.8175 61.2777 98.7787 61.293 99.5225C61.3836 99.5775 61.4735 99.6397 61.5605 99.709C62.4404 100.409 62.7831 101.602 62.7832 103.049C62.7832 105.991 61.4902 109.206 59.0371 111.41C58.5059 111.887 57.9229 112.315 57.291 112.681C57.2015 112.8 57.0848 112.903 56.9443 112.979C56.3705 113.29 56.0317 113.798 55.9141 114.51C55.7913 115.253 55.9186 116.209 56.3359 117.257C57.1354 119.264 58.8922 121.336 61.2178 122.454L61.3652 122.52C61.3855 122.53 61.4088 122.542 61.4336 122.554L61.5449 122.603C61.571 122.614 61.5964 122.627 61.6211 122.64C62.0853 122.838 62.9332 123.119 63.9385 123.251C65.1701 123.412 66.5027 123.33 67.6211 122.731C68.1408 122.453 68.7894 122.646 69.0693 123.163C69.3492 123.68 69.1546 124.325 68.6348 124.604L68.3213 124.761C66.7455 125.499 65.0432 125.539 63.6592 125.358C62.5922 125.219 61.6432 124.938 60.9785 124.675L60.9746 124.678C60.9423 124.703 60.8716 124.777 60.8037 124.956C60.6608 125.333 60.6055 125.983 60.7598 126.845C61.0651 128.549 62.1159 130.651 63.9209 132.107C67.1892 134.744 70.8516 135.672 74.1885 135.639L74.8516 135.62C78.1708 135.46 81.0388 134.375 82.7109 133.203L83.0293 132.968C85.7409 130.849 88.3666 126.678 89.3438 124.824C89.3661 124.782 89.3909 124.741 89.418 124.703C89.0874 123.009 88.8447 121.159 88.7803 119.277L88.7637 118.47C88.7522 116.588 88.931 114.662 89.4082 112.835C87.6097 113.504 85.2711 113.995 83.0117 114.235C81.4479 114.402 79.867 114.455 78.4561 114.352C77.071 114.25 75.7416 113.993 74.7568 113.464C73.0631 112.554 72.1699 111.365 71.8594 110.129L71.8057 109.881C71.666 109.139 71.739 108.439 71.9131 107.848C71.7946 107.806 71.6774 107.76 71.5615 107.709C70.1951 107.106 69.232 105.89 68.8506 104.019L68.7822 103.636C68.4593 101.548 69.1045 99.7571 69.707 98.7227C69.1767 97.4454 69.089 95.6701 70.1973 93.7256L70.4355 93.335C71.5793 91.5661 73.4601 90.7918 75.8809 90.3428L76.3721 90.2568C77.6893 90.0408 79.2533 89.8912 81.0635 89.7432L82.9551 89.5928C84.0335 89.5088 85.1856 89.4193 86.4111 89.3135C84.5265 85.8082 81.2018 80.7935 76.7031 75.8594C76.5778 75.771 76.4728 75.6561 76.3955 75.5234C76.0406 75.1391 75.6786 74.7552 75.3096 74.373C69.7132 68.5765 62.5771 63.1842 54.3486 60.7051ZM40.6982 107.465C39.1632 108.468 36.6317 112.071 40.2559 120.929C42.7239 126.961 46.1653 129.771 49.2539 131.087C51.9881 132.252 54.541 132.288 56.1104 132.21L56.7207 132.173C58.1653 132.07 59.464 131.678 60.3535 131.32C59.5642 130.143 59.0342 128.882 58.7578 127.713L58.6553 127.218C58.4637 126.149 58.4744 125.073 58.8037 124.205C58.8718 124.026 58.9565 123.849 59.0596 123.681C56.9741 122.342 55.3915 120.396 54.5146 118.433L54.3486 118.04C53.8344 116.749 53.6016 115.394 53.8047 114.165C53.8179 114.085 53.8336 114.006 53.8506 113.927C52.2223 114.212 50.3998 114.152 48.4072 113.644C44.8687 112.741 42.3202 110.304 40.6982 107.465ZM53.1006 91.085C52.1415 90.7484 50.905 90.6458 49.3057 90.9404C49.165 91.0432 48.9968 91.1126 48.8115 91.1367C47.3525 91.3259 43.7891 92.4671 41.623 95.3896C41.0512 96.1612 40.6784 97.4082 40.6318 98.9854C40.5859 100.542 40.8623 102.318 41.4766 104.051C42.7132 107.538 45.2298 110.64 48.9385 111.585C52.5334 112.501 55.2968 111.694 57.2285 110.151L57.6035 109.833C59.4624 108.163 60.5091 105.746 60.6328 103.497L60.6455 103.049C60.6454 101.84 60.3464 101.465 60.2246 101.368C60.1209 101.286 59.8667 101.189 59.292 101.358C58.7376 101.522 58.0927 101.881 57.4941 102.338C56.8943 102.796 56.4263 103.285 56.1895 103.639C55.862 104.127 55.1983 104.259 54.707 103.934C54.2159 103.608 54.0837 102.948 54.4111 102.46C54.7651 101.932 55.3098 101.366 55.9248 100.863L56.1924 100.652C56.8261 100.169 57.5782 99.7116 58.3516 99.4297L58.6846 99.3203C58.8305 99.2773 58.9832 99.2396 59.1406 99.21C59.1158 98.8103 59.0609 98.3431 58.9609 97.8486L58.8457 97.3467C58.5643 96.2584 58.0798 95.2004 57.3232 94.4482C56.901 94.0286 56.1491 93.9518 54.8896 94.541C53.7056 95.095 52.5113 96.0594 51.7803 96.7861C51.3889 97.1752 50.7695 97.1997 50.3496 96.8594L50.2686 96.7861C49.8511 96.3711 49.8511 95.6982 50.2686 95.2832C51.1054 94.4512 52.4984 93.3111 53.9795 92.6182C54.2726 92.4811 54.5909 92.3519 54.9248 92.2471C54.4148 91.7289 53.8131 91.335 53.1006 91.085ZM81.1689 45.8711C83.6339 45.8711 85.9969 46.8724 87.7578 49.3174C89.4797 51.7082 90.5712 55.4 90.7891 60.707C90.9102 63.6578 89.6859 66.008 87.8076 67.6221C85.9525 69.2163 83.4815 70.0799 81.0537 70.1816C78.6279 70.2833 76.1367 69.6273 74.29 68.041C72.41 66.426 71.3158 63.9463 71.5508 60.6748C71.9816 54.6779 73.0659 50.9603 74.7578 48.7373C76.5327 46.4055 78.8469 45.8711 81.1689 45.8711ZM81.1689 49.9971C80.3213 49.9971 79.7264 50.0915 79.2695 50.2705C78.9007 50.4151 78.5513 50.6412 78.2031 51.0459L78.0547 51.2314C77.1803 52.3802 76.2242 54.8188 75.7637 59.9141L75.6787 60.9697C75.5267 63.087 76.2089 64.2429 76.9912 64.915L77.1621 65.0537C78.0452 65.7263 79.3577 66.1234 80.8799 66.0596L81.1826 66.041C82.69 65.9178 84.1108 65.3527 85.1064 64.4971L85.2881 64.333C86.116 63.5508 86.6426 62.5234 86.6592 61.1709L86.6543 60.876C86.4649 56.2636 85.5724 53.5419 84.5928 52.0137L84.3965 51.7236C83.4537 50.4146 82.3727 49.9971 81.1689 49.9971ZM94.2451 50.0693C94.3926 49.5011 94.9753 49.1592 95.5469 49.3057C96.1185 49.4523 96.4629 50.0322 96.3154 50.6006L96.2754 50.7686C96.0949 51.6224 96.1663 52.7024 96.6572 53.6455C97.1587 54.6088 98.1415 55.5163 99.9795 55.8818C101.338 56.1519 102.473 55.63 103.353 54.7588L103.525 54.5801C103.921 54.1517 104.241 53.6692 104.474 53.2051L104.568 53.0078C104.753 52.6022 104.848 52.2617 104.884 52.0244L104.901 51.8223C104.902 51.2355 105.38 50.7597 105.971 50.7598C106.561 50.76 107.039 51.2364 107.039 51.8232L107.029 52.0635C106.985 52.6361 106.793 53.2749 106.517 53.8828C106.193 54.5952 105.718 55.3479 105.101 56.0166C103.864 57.3563 101.96 58.4428 99.5605 57.9658C97.1237 57.4812 95.576 56.1927 94.7588 54.623C93.964 53.0964 93.9027 51.3887 94.2451 50.0693ZM70.2959 49.9258C70.8774 49.8252 71.4309 50.212 71.5322 50.79C71.6462 51.4415 71.5224 52.1477 71.2861 52.7891C71.0443 53.4454 70.6563 54.1131 70.1475 54.7129C69.1323 55.9095 67.5536 56.9238 65.5625 56.9238C63.7814 56.9238 62.3922 56.0102 61.5723 54.8936C60.8007 53.8426 60.3638 52.3435 60.9717 51.1348C61.2357 50.6098 61.8782 50.3967 62.4062 50.6592C62.9343 50.9217 63.1478 51.5609 62.8838 52.0859C62.7793 52.2946 62.7703 52.9208 63.2988 53.6406C63.7495 54.2544 64.4678 54.7353 65.3779 54.793L65.5625 54.7988C66.7022 54.7988 67.6718 54.258 68.376 53.498L68.5137 53.3428C68.8244 52.9765 69.0606 52.5839 69.2168 52.2148L69.2783 52.0586C69.3966 51.7377 69.437 51.4815 69.4375 51.3047L69.4258 51.1543C69.3249 50.5763 69.7146 50.0265 70.2959 49.9258ZM31.2793 44.375C31.2793 42.8539 30.0465 41.6204 28.5254 41.6201C27.0041 41.6201 25.7705 42.8537 25.7705 44.375C25.7707 45.8961 27.0043 47.1289 28.5254 47.1289V49.1289L28.2803 49.123C25.8491 48.9998 23.8995 47.0503 23.7764 44.6191L23.7705 44.375C23.7705 41.7492 25.8995 39.6201 28.5254 39.6201L28.7695 39.626C31.2817 39.7533 33.2793 41.8312 33.2793 44.375L33.2734 44.6191C33.1462 47.1312 31.069 49.1287 28.5254 49.1289V47.1289C30.0463 47.1287 31.2791 45.8959 31.2793 44.375ZM26.5215 30.1123C26.5212 26.8408 23.8692 24.1886 20.5977 24.1885C17.326 24.1885 14.6731 26.8407 14.6729 30.1123C14.6729 33.3841 17.3258 36.0371 20.5977 36.0371V38.0371L20.1895 38.0264C16.1377 37.8209 12.889 34.5723 12.6836 30.5205L12.6729 30.1123C12.6731 25.7361 16.2214 22.1885 20.5977 22.1885L21.0049 22.1992C25.1918 22.4113 28.5212 25.8728 28.5215 30.1123L28.5117 30.5205C28.2995 34.7074 24.8372 38.037 20.5977 38.0371V36.0371C23.8694 36.037 26.5215 33.3841 26.5215 30.1123ZM18.6025 10.3018C18.6025 5.7171 14.8864 2.00017 10.3018 2C5.717 2 2 5.717 2 10.3018C2.00017 14.8864 5.7171 18.6025 10.3018 18.6025V20.6025L9.77148 20.5898C4.50418 20.3229 0.280916 16.0993 0.0136719 10.832L0 10.3018C0 4.61243 4.61243 0 10.3018 0L10.832 0.0136719C16.2748 0.289822 20.6025 4.79038 20.6025 10.3018L20.5898 10.832C20.3137 16.2747 15.813 20.6024 10.3018 20.6025V18.6025C14.8863 18.6024 18.6024 14.8863 18.6025 10.3018Z" fill="white"/>
</svg>

`;
          gsap.to(svgIcon, {
            opacity: 1,
            duration: 0.25,
            ease: "power2.inOut"
          });
        }
      });
    } else {
      // Focus mode colors with GSAP animation
      gsap.to(body, {
        background: "linear-gradient(180deg, var(--enfoque-bg-1), var(--enfoque-bg-2), var(--enfoque-bg-3))",
        duration: 0.5,
        ease: "power2.inOut"
      });

      // Update circle gradient with animation
      const gradient = document.querySelector("#gradient");
      gsap.to(gradient, {
        innerHTML: `
          <stop offset="0%" stop-color="#1F5F50"/>
          <stop offset="50%" stop-color="#EA8727"/>
          <stop offset="100%" stop-color="#E1F3C1"/>
        `,
        duration: 0.5,
        ease: "power2.inOut"
      });

      gsap.to(timerDisp, {
        color: "#433C3C",
        duration: 0.5,
        ease: "power2.inOut"
      });

      gsap.to(".ring-bg", {
        stroke: "#eee",
        duration: 0.5,
        ease: "power2.inOut"
      });

      // Update mode text with fade animation
      gsap.to(modeText, {
        opacity: 0,
        duration: 0.25,
        ease: "power2.inOut",
        onComplete: () => {
          modeText.textContent = "Tiempo de enfoque";
          gsap.to(modeText, {
            opacity: 1,
            duration: 0.25,
            ease: "power2.inOut"
          });
        }
      });

      // Update SVG icon for focus mode
      gsap.to(svgIcon, {
        opacity: 0,
        duration: 0.25,
        ease: "power2.inOut",
        onComplete: () => {
          svgIcon.innerHTML = `<svg width="115" height="127" viewBox="0 0 115 127" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M58.5957 47.0324C59.7091 36.8267 53.2145 31.4456 49.8745 31.4456C43.38 31.4456 41.5244 38.8679 41.3388 47.0324C41.1533 55.197 57.4824 57.2381 58.5957 47.0324Z" fill="#433C3C"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M87.7203 3.24282C82.735 5.17954 78.5207 8.75764 76.1819 11.4564L75.634 12.0885L74.9487 11.6088C74.4732 11.276 72.9952 10.5942 70.1817 9.86319C67.4049 9.14169 63.4034 8.39131 57.9509 7.87553C51.222 7.23901 43.3613 8.20121 36.7095 12.1563C30.0925 16.0908 24.5813 23.0385 22.5833 34.5728C21.965 38.1416 22.0225 41.3485 22.5711 44.2163C22.6008 44.2525 22.6281 44.2914 22.6527 44.3328C22.7872 44.5598 22.8138 44.8207 22.7479 45.0562C23.6867 49.1403 25.6309 52.5084 28.0089 55.2315C32.2072 60.0392 37.7757 62.8504 41.5959 63.9546C42.0881 64.0969 42.3718 64.6113 42.2295 65.1036C42.0872 65.5958 41.5728 65.8795 41.0806 65.7372C39.0987 65.1643 36.695 64.1716 34.2351 62.7194C33.1971 64.2932 31.7495 66.3252 30.3419 68.1887C29.1888 69.7151 28.0245 71.1797 27.1198 72.1877C28.1524 72.3836 29.0717 72.6143 29.8791 72.8676C31.1154 73.2554 32.1116 73.7033 32.8544 74.1765C33.5649 74.6292 34.1674 75.1835 34.4134 75.8393C34.5021 76.0759 34.517 76.3181 34.4727 76.5466C34.4742 77.8059 34.4833 79.1313 34.4949 80.4609C35.5193 79.7647 36.985 78.9889 38.8448 78.4309C39.9408 78.1021 41.2285 78.0908 42.5757 78.1914C43.6349 78.2706 44.805 78.4266 46.0244 78.5892C46.362 78.6342 46.7034 78.6797 47.0472 78.7242C50.2622 79.1405 53.8441 79.4914 57.4895 78.7801C60.3071 78.2303 62.7697 76.6442 64.7227 74.8311C66.6751 73.0184 68.0602 71.0321 68.7248 69.7896C68.9665 69.3378 69.5287 69.1675 69.9805 69.4091C70.4323 69.6508 70.6027 70.213 70.361 70.6648C69.6029 72.0821 68.0933 74.2337 65.9852 76.1909C63.8775 78.1477 61.1135 79.9635 57.8449 80.6013C53.8824 81.3745 50.042 80.9831 46.8089 80.5644C46.4449 80.5173 46.0903 80.47 45.7448 80.424C44.5354 80.2629 43.4376 80.1166 42.4374 80.0418C41.1461 79.9453 40.1376 79.9804 39.378 80.2082C36.7321 81.002 35.071 82.2586 34.5173 82.8074C34.5175 82.8287 34.5177 82.85 34.518 82.8712C34.5282 83.8987 34.5382 84.9057 34.5456 85.8624C34.5471 86.0489 34.5485 86.2337 34.5497 86.4166C34.9372 86.2518 35.4307 86.0629 36.0346 85.8616C37.0604 85.5197 38.4798 85.5379 39.5648 85.6071C40.1312 85.6433 40.6523 85.6973 41.0491 85.7414C41.1461 85.7521 41.2313 85.7618 41.3082 85.7706C41.3947 85.7804 41.4705 85.789 41.5401 85.7966C41.628 85.8061 41.6763 85.8105 41.6981 85.8124C41.7133 85.8138 41.7155 85.814 41.7092 85.814C42.2216 85.814 42.637 86.2294 42.637 86.7418C42.637 87.2542 42.2216 87.6696 41.7092 87.6696C41.601 87.6696 41.4506 87.6534 41.3397 87.6413C41.2699 87.6337 41.1845 87.624 41.0913 87.6135C41.0129 87.6046 40.929 87.595 40.8442 87.5856C40.4583 87.5427 39.9704 87.4924 39.4466 87.4589C38.3513 87.389 37.2657 87.4072 36.6214 87.622C35.9773 87.8367 35.4938 88.0277 35.1561 88.1759C34.9871 88.25 34.857 88.3125 34.7631 88.3606C34.7162 88.3847 34.68 88.4043 34.6538 88.4193C34.6293 88.4332 34.6162 88.4415 34.6162 88.4415C34.5972 88.4542 34.5777 88.4662 34.5581 88.4773C34.5584 89.5369 34.5507 90.4715 34.5294 91.2114C35.1578 91.1067 35.9121 91.0097 36.5136 91.0097C37.4744 91.0097 39.74 91.2666 40.7109 91.388C41.2194 91.4516 41.58 91.9153 41.5165 92.4237C41.4529 92.9322 40.9892 93.2928 40.4808 93.2293C39.4724 93.1032 37.3341 92.8653 36.5136 92.8653C35.903 92.8653 35.0066 93.0037 34.382 93.1223C34.3412 93.3998 34.2919 93.673 34.234 93.9418C34.4091 94.0548 34.5473 94.2272 34.6149 94.4415C34.9031 95.3541 36.3709 97.8102 39.7968 99.0436C41.5265 99.6663 43.8488 99.9847 46.1012 100.118C48.0537 100.233 49.8959 100.206 51.1507 100.137C53.4072 96.4053 57.3201 94.5439 61.2349 94.7218C62.3416 94.7721 63.4547 95.0626 64.506 95.5526C64.5663 95.524 64.6306 95.5016 64.6983 95.4862C66.0307 95.1834 68.1864 94.608 70.2951 93.8727C72.4397 93.1248 74.4029 92.2557 75.4524 91.403C77.7396 89.5446 81.1227 85.5493 82.5472 83.7531C82.8656 83.3517 83.4492 83.2843 83.8507 83.6027C84.2522 83.9211 84.3195 84.5047 84.0011 84.9062C82.5804 86.6975 79.0855 90.842 76.6225 92.8431C75.2968 93.9203 73.054 94.8758 70.9061 95.6248C69.4181 96.1436 67.9118 96.5845 66.6636 96.9127C68.8872 98.7301 70.4707 101.527 70.4707 104.741C70.4707 106.762 70.4084 108.166 70.3281 109.106C70.2881 109.576 70.2428 109.939 70.1965 110.21C70.1572 110.44 70.1017 110.708 70.0016 110.908C69.7725 111.367 69.2152 111.552 68.7569 111.323C68.3122 111.101 68.1241 110.57 68.3225 110.12V110.12C68.3225 110.12 68.3398 110.059 68.3674 109.898C68.4023 109.693 68.442 109.385 68.4793 108.949C68.5537 108.077 68.6151 106.728 68.6151 104.741C68.6151 100.444 65.092 97.0569 61.6388 96.6178L61.0005 101.884C60.9388 102.392 60.4765 102.755 59.9678 102.693C59.4591 102.631 59.0967 102.169 59.1584 101.66L59.7701 96.6137C56.9265 96.9018 54.2312 98.4854 52.6147 101.308C52.5777 101.426 52.5176 101.534 52.4395 101.627C52.2922 101.907 52.1551 102.198 52.0291 102.5C51.1683 104.566 50.7101 107.626 50.7781 110.938C50.846 114.24 51.435 117.695 52.5889 120.535C53.604 123.034 56.3232 124.749 61.0041 125.085C65.6724 125.42 72.0753 124.349 79.9906 121.496C87.9234 118.637 92.6157 115.762 95.2735 111.144C97.9563 106.482 98.6762 99.8624 98.1201 89.2025C97.249 72.5066 86.7404 62.4336 81.6975 59.5265L80.7232 58.9648L81.4597 58.115C82.2589 57.1928 84.304 54.7904 86.0753 52.5763C87.7064 50.5374 88.4886 47.4504 88.6639 46.1649L88.8605 44.7228L90.0849 45.5098C91.1783 46.2128 93.6062 46.8816 96.1292 46.6423C98.6094 46.4072 101 45.3183 102.299 42.7209C103.215 40.8884 103.388 39.5329 103.269 38.365C103.169 37.3764 102.867 36.504 102.514 35.4839C102.428 35.2352 102.339 34.9778 102.249 34.7078L101.972 33.8779L102.784 33.553C103.495 33.2687 104.706 32.6697 105.951 31.8205C107.201 30.9673 108.424 29.9023 109.223 28.7043C110.292 27.1001 112.318 23.4278 112.384 19.0226C112.448 14.6953 110.626 9.50312 103.716 4.74732C98.3193 1.03261 92.6754 1.3178 87.7203 3.24282ZM50.2169 102.032C49.0153 102.067 47.5365 102.061 45.992 101.97C43.6828 101.834 41.1497 101.503 39.1682 100.789C36.1645 99.7081 34.3607 97.7941 33.4572 96.2995C32.7299 97.89 31.6397 99.2589 30.2117 100.352C27.7348 102.247 24.3177 103.257 20.1845 103.257C20.0908 103.257 19.9975 103.256 19.9046 103.255C19.9346 103.661 19.9595 104.101 19.9708 104.526C19.982 104.948 19.9803 105.373 19.9536 105.742C19.9303 106.065 19.8806 106.496 19.7154 106.826C19.4863 107.284 18.929 107.47 18.4707 107.241C18.0123 107.012 17.8266 106.454 18.0557 105.996C18.0504 106.007 18.0508 106.005 18.0547 105.986C18.0629 105.947 18.0866 105.833 18.1028 105.608C18.1233 105.325 18.1263 104.968 18.1158 104.575C18.1032 104.099 18.0717 103.597 18.0355 103.153C11.6565 102.525 7.28319 99.0791 5.76738 94.4969C4.74603 95.0288 3.46771 96.148 2.65655 98.0213C1.72588 100.171 1.37778 103.395 2.88153 107.977C4.81759 113.878 6.70265 117.156 8.75797 118.957C10.7566 120.709 13.0312 121.16 16.0749 121.071C19.1092 120.981 23.4536 119.946 27.8502 118.87C28.0309 118.826 28.2117 118.781 28.3925 118.737C32.5244 117.725 36.6684 116.71 39.4516 116.617C43.2046 116.492 47.2145 116.533 49.5159 116.586C49.1538 114.736 48.961 112.825 48.923 110.976C48.8543 107.633 49.2902 104.4 50.2169 102.032ZM49.946 118.453C47.7848 118.395 43.4968 118.339 39.5134 118.472C36.929 118.558 32.9431 119.534 28.6747 120.579L28.2912 120.672C23.9665 121.731 19.4042 122.829 16.1295 122.925C12.8642 123.021 10.0361 122.545 7.53503 120.353C5.09066 118.211 3.07908 114.531 1.11843 108.556C-0.495197 103.638 -0.193841 99.9344 0.953738 97.2841C2.03356 94.7902 3.83457 93.2999 5.32225 92.6545C4.90001 90.0439 4.87956 86.3438 4.97071 83.1487C5.05566 80.1709 5.24043 77.5599 5.31207 76.5477C5.31813 76.462 5.32338 76.3878 5.32769 76.3258C5.32642 76.2206 5.33469 76.1159 5.35198 76.0123C5.50407 75.1013 6.14006 74.4001 6.90983 73.878C7.68956 73.3492 8.72329 72.9212 9.92043 72.5819C12.3215 71.9014 15.5676 71.5261 19.2563 71.5261C21.3494 71.5261 23.2191 71.6422 24.8686 71.8415C24.8935 71.8132 24.9204 71.7862 24.9493 71.7605C25.7029 71.0906 27.2248 69.2366 28.8612 67.0702C30.2448 65.2386 31.6571 63.2555 32.6637 61.7316C30.5546 60.3219 28.461 58.5703 26.6112 56.452C24.1868 53.6756 22.1864 50.2735 21.1197 46.2053C18.717 47.1807 16.3819 46.8459 14.3716 45.9282C12.0614 44.8735 10.1452 43.0419 8.88761 41.4942C7.70404 40.0375 7.50726 38.1716 7.6588 36.5679C7.77168 35.3733 8.0846 34.2381 8.41844 33.3569C5.56485 31.6952 1.17091 27.3139 0.887013 19.7905C0.494837 9.39787 10.2419 -0.320597 21.3627 0.459807C29.6313 1.04006 34.4932 6.80447 36.2636 10.2691C43.2303 6.30642 51.2884 5.38143 58.1257 6.0282C63.6582 6.55155 67.7594 7.3166 70.6483 8.06725C72.8144 8.63007 74.3452 9.19638 75.2899 9.6698C77.8487 6.88691 82.0638 3.44962 87.0483 1.51317C92.4102 -0.569865 98.7347 -0.934127 104.768 3.21882C112.147 8.29759 114.314 14.0534 114.239 19.0503C114.166 23.9694 111.924 27.9978 110.766 29.7336C109.784 31.2076 108.347 32.4311 106.997 33.3531C106.021 34.0192 105.058 34.5491 104.283 34.9184C104.632 35.9199 104.996 37.0007 105.116 38.1779C105.273 39.736 105.013 41.4422 103.959 43.5507C102.288 46.8912 99.2054 48.2145 96.3044 48.4896C94.0783 48.7007 91.8508 48.3089 90.2636 47.6683C89.8658 49.369 89.0184 51.8679 87.5243 53.7355C86.1314 55.4766 84.575 57.3282 83.5712 58.5046C89.2684 62.2547 99.1128 72.6156 99.9731 89.1058C100.53 99.785 99.8585 106.897 96.8818 112.069C93.8801 117.285 88.6451 120.349 80.6199 123.242C72.5772 126.141 65.8983 127.297 60.8712 126.936C55.8567 126.576 52.2669 124.673 50.8698 121.234C50.5102 120.349 50.2031 119.416 49.946 118.453ZM34.6751 11.239C33.1782 8.20469 28.7733 2.83999 21.2328 2.31083C11.1999 1.60678 2.39122 10.4441 2.74127 19.7206C3.0226 27.1758 7.7768 31.0888 9.9884 32.084L10.8567 32.4747L10.4436 33.3326C10.081 34.0857 9.63487 35.3803 9.50615 36.7425C9.37626 38.117 9.58151 39.4056 10.3278 40.324C11.4825 41.7452 13.1846 43.3465 15.1422 44.2402C16.867 45.0276 18.7587 45.2588 20.7101 44.3607C20.1569 41.3353 20.1112 37.9719 20.7549 34.2561C22.732 22.8427 28.0599 15.5675 34.6751 11.239ZM7.18973 76.2916C7.19002 76.2868 7.19031 76.2819 7.19059 76.2771C7.23984 76.0739 7.42389 75.7714 7.95137 75.4137C8.50543 75.0379 9.33192 74.6773 10.4264 74.3671C12.6085 73.7487 15.6711 73.3817 19.2563 73.3817C23.7323 73.3817 27.0679 73.9304 29.3236 74.6381C30.4533 74.9925 31.2895 75.3797 31.8573 75.7414C32.1487 75.9271 32.3424 76.0887 32.4684 76.2158C32.2555 76.3435 31.9453 76.4884 31.5342 76.642C30.658 76.9693 29.4483 77.2903 28.0579 77.5677C25.2766 78.1225 21.9044 78.4767 19.2862 78.3923L19.2713 78.3918H19.2563C16.9532 78.3918 13.7862 78.1754 11.2016 77.7058C9.90212 77.4698 8.80362 77.179 8.04532 76.8453C7.66435 76.6777 7.41981 76.5208 7.28158 76.3932C7.23021 76.3458 7.20325 76.3119 7.18973 76.2916ZM7.046 78.4271C6.96798 79.6852 6.87769 81.3732 6.82553 83.2016C6.73223 86.4721 6.7644 90.1051 7.18139 92.522C7.97096 97.0985 12.0423 100.948 18.9414 101.364C19.3461 101.388 19.7605 101.401 20.1845 101.401C24.0302 101.401 27.0147 100.462 29.0839 98.8782C31.1368 97.3071 32.364 95.0463 32.6207 92.2246C32.7103 91.239 32.7133 88.8489 32.6901 85.8768C32.6827 84.9285 32.6728 83.926 32.6626 82.9008C32.6472 81.3517 32.6313 79.7506 32.6229 78.2056C32.4814 78.2656 32.3345 78.3238 32.1835 78.3802C31.1786 78.7556 29.8626 79.0998 28.4209 79.3874C25.5431 79.9615 22.0326 80.3357 19.2414 80.2474C16.8535 80.2464 13.5805 80.024 10.8699 79.5315C9.51891 79.2861 8.25372 78.9643 7.29795 78.5437C7.213 78.5063 7.12887 78.4675 7.046 78.4271ZM44.0857 36.5592C42.8652 39.2619 42.3577 43.0068 42.2658 47.0536C42.2273 48.7462 43.032 50.143 44.3682 51.1788C45.7201 52.2269 47.5919 52.8771 49.5358 52.9953C51.4789 53.1134 53.408 52.6951 54.8904 51.7128C56.3465 50.7479 57.4245 49.2077 57.6728 46.9319C58.2052 42.0513 56.9163 38.386 55.1536 35.9569C54.2684 34.737 53.2645 33.8296 52.3101 33.2324C51.3424 32.627 50.4805 32.3734 49.8739 32.3734C48.4404 32.3734 47.3056 32.7784 46.3856 33.4733C45.4533 34.1775 44.6914 35.2182 44.0857 36.5592ZM45.2672 31.9926C46.5275 31.0407 48.0601 30.5179 49.8739 30.5179C50.9373 30.5179 52.1397 30.937 53.2943 31.6594C54.4623 32.3902 55.6386 33.4658 56.6554 34.867C58.6966 37.6799 60.0983 41.808 59.5174 47.1331C59.209 49.9601 57.8284 51.9919 55.9154 53.2596C54.0288 54.5097 51.6785 54.9845 49.4233 54.8474C47.1689 54.7104 44.9237 53.9574 43.2313 52.6454C41.5232 51.3212 40.3563 49.4011 40.4107 47.0114C40.5042 42.8937 41.0174 38.8451 42.3946 35.7955C43.0879 34.2604 44.0192 32.9353 45.2672 31.9926ZM29.6479 34.9712C30.1603 34.9712 30.5757 35.3866 30.5757 35.899C30.5757 35.9442 30.5826 36.0973 30.619 36.3076C30.7393 36.6312 31.0267 37.1306 31.4773 37.5971C32.0292 38.1686 32.6386 38.4968 33.1735 38.4968C34.1096 38.4968 34.9257 38.1009 35.5442 37.579C35.8521 37.3192 36.0972 37.0391 36.2699 36.7869C36.4522 36.5207 36.5189 36.337 36.5316 36.2738C36.6321 35.7713 37.1209 35.4454 37.6233 35.5459C38.0958 35.6404 38.4121 36.0783 38.3646 36.548C38.3803 36.7017 38.3577 36.8615 38.2914 37.0131C37.7822 38.1769 36.0112 40.5319 32.9335 40.3508C30.9999 40.2371 29.8952 39.2343 29.3196 38.1741C29.0513 37.6797 28.9017 37.1833 28.8191 36.7755C28.7825 36.6578 28.7539 36.5427 28.7343 36.4314C28.7165 36.3306 28.7157 36.2307 28.7298 36.1347C28.7223 36.0317 28.7201 35.9513 28.7201 35.899C28.7201 35.3866 29.1355 34.9712 29.6479 34.9712ZM63.7096 35.9382C64.2003 35.7909 64.7176 36.0694 64.8648 36.5602C65.1663 37.5652 66.4616 39.6102 69.1718 39.6102C70.5419 39.6102 71.413 39.1024 71.971 38.5101C72.5545 37.8907 72.825 37.1439 72.8932 36.6892C72.9692 36.1825 73.4416 35.8333 73.9483 35.9093C74.4551 35.9853 74.8043 36.4577 74.7282 36.9645C74.6109 37.7468 74.1948 38.8556 73.3217 39.7825C72.423 40.7365 71.0675 41.4658 69.1718 41.4658C65.3503 41.4658 63.5282 38.5626 63.0875 37.0934C62.9403 36.6026 63.2188 36.0854 63.7096 35.9382ZM8.57408 56.4272C9.022 56.676 9.18338 57.2408 8.93454 57.6888C8.82282 57.8899 8.64045 58.309 8.52205 58.8239C8.40342 59.3397 8.36378 59.8876 8.47253 60.377C8.51637 60.5743 8.62112 60.7513 8.82106 60.9554C8.9967 61.1347 9.19552 61.2888 9.45112 61.4868C9.52 61.5402 9.593 61.5968 9.67079 61.6579C10.3441 62.187 11.2777 62.9872 11.2777 64.4749C11.2777 65.3597 11.1774 66.0471 11.0358 66.5624C10.9051 67.0381 10.7123 67.4657 10.4493 67.7288C10.087 68.0911 9.49952 68.0911 9.13719 67.7288C8.78375 67.3754 8.77508 66.8077 9.1112 66.4438C9.10884 66.4462 9.10725 66.4472 9.10725 66.4472C9.10468 66.4454 9.17126 66.3447 9.24652 66.0708C9.3369 65.7418 9.42212 65.2231 9.42212 64.4749C9.42212 63.9216 9.14978 63.6084 8.52429 63.1169C8.47373 63.0772 8.41903 63.035 8.36139 62.9905C8.0965 62.786 7.76947 62.5336 7.49545 62.2538C7.13877 61.8897 6.80285 61.4172 6.66113 60.7795C6.47298 59.9328 6.55705 59.089 6.71367 58.408C6.87051 57.726 7.11492 57.1432 7.31247 56.7876C7.56132 56.3397 8.12616 56.1783 8.57408 56.4272ZM56.0605 57.149C56.3147 57.5939 56.1601 58.1606 55.7152 58.4149C54.7414 58.9713 52.1999 59.9963 49.4482 59.8344C46.7826 59.6776 44.8747 58.8554 44.1635 58.3813C43.7371 58.097 43.6219 57.521 43.9062 57.0947C44.1904 56.6683 44.7664 56.5531 45.1928 56.8373C45.5949 57.1055 47.1755 57.8419 49.5571 57.982C51.8525 58.1171 54.0366 57.2369 54.7946 56.8038C55.2395 56.5495 55.8062 56.7041 56.0605 57.149ZM16.2878 56.8671C16.8002 56.8671 17.2156 57.2825 17.2156 57.7949C17.2156 57.9925 17.1561 58.1446 17.1188 58.2249C17.0792 58.3102 17.0346 58.3774 17.0054 58.4186C16.9528 58.4931 16.8896 58.5667 16.8525 58.61L16.8424 58.6217C16.7542 58.7247 16.675 58.817 16.5958 58.9358C16.4473 59.1586 16.2878 59.4928 16.2878 60.0216C16.2878 60.0879 16.3056 60.1804 16.4641 60.3616C16.6079 60.5259 16.7844 60.675 17.0296 60.8821C17.1012 60.9425 17.1786 61.0078 17.2627 61.0799C17.9385 61.6592 18.8856 62.5497 18.8856 64.1038C18.8856 66.2661 17.6615 67.4325 16.7991 67.7559C16.3193 67.9358 15.7845 67.6927 15.6046 67.213C15.4247 66.7332 15.6678 66.1984 16.1476 66.0185C16.2748 65.9708 17.03 65.5043 17.03 64.1038C17.03 63.4313 16.6782 63.0229 16.0551 62.4888C16.0044 62.4453 15.9492 62.399 15.8911 62.3501C15.6319 62.1322 15.3138 61.8648 15.0677 61.5835C14.7391 61.208 14.4322 60.6975 14.4322 60.0216C14.4322 59.0658 14.7366 58.3795 15.0519 57.9065C15.1947 57.6923 15.3375 57.526 15.4235 57.4258L15.4384 57.4085C15.4429 57.4033 15.447 57.3984 15.4508 57.3939C15.6004 57.0823 15.919 56.8671 16.2878 56.8671Z" fill="#433C3C"/>
</svg>
`;
          gsap.to(svgIcon, {
            opacity: 1,
            duration: 0.25,
            ease: "power2.inOut"
          });
        }
      });
    }
  }

  // 6. Control del reloj
  let iv;
  function startClock(){
    clearInterval(iv);
    iv = setInterval(() => {
      if (remaining > 0) {
        remaining--; update();
      } else {
        clearInterval(iv);
        if (isRestTimer) {
          // Rest timer finished, go back to focus
          isRestTimer = false;
          duration = focusMins * 60;
          remaining = duration;
          update();
          updateVisualMode(false);
          
          // Show focus timer first
          focusSect.style.display = "flex";
          promptSect.style.display = "none";
          popupCats.style.display = "none";
          popupLogro.style.display = "none";
          
          // Reset mask position for new timer
          gsap.set(maskRect, { attr: { y: 300 } });
          
          // Show popup after a small delay
          setTimeout(() => {
            showPopup();
          }, 50);
        } else {
          // Focus timer finished, show popup
          showPopup();
        }
      }
    }, 1000);
    
    // Reset and play the fill animation
    fillAnim.pause(0);
    gsap.set(maskRect, { attr: { y: 300 } });
    fillAnim.play();
  }
  function pauseClock(){
    clearInterval(iv);
    fillAnim.pause();
  }
  function resetClock(){
    clearInterval(iv);
    remaining = duration; update();
    fillAnim.pause(0);
    gsap.set(maskRect, { attr: { y: 300 } });
  }

  // 7. Conectar botones
  startBtn.onclick = () => {
    introSect.style.display = "none";
    focusSect.style.display = "flex";
    update();
  };
  playBtn.onclick  = startClock;
  pauseBtn.onclick = pauseClock;
  resetBtn.onclick = resetClock;

  // 8. Popup y prompt
  function showPopup(){
    nameSample.textContent = userName;
    popupLogro.style.display = "flex";
    gsap.from(popupLogro, {
      opacity: 0,
      scale: 0.8,
      duration: 0.5,
      ease: "back.out(1.7)"
    });
  }

  function showCategoryPopup() {
    // Clear previous categories
    catsList.innerHTML = '';
    
    // Add categories from localStorage
    categories.forEach(category => {
      const div = document.createElement('div');
      div.className = 'category-item';
      div.innerHTML = `
        <span>${category}</span>
        <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 0C8.954 0 0 8.954 0 20C0 31.046 8.954 40 20 40C31.046 40 40 31.046 40 20C40 8.954 31.046 0 20 0Z" fill="white"/>
        </svg>
      `;
      
      // Add click handler
      div.onclick = () => {
        // Remove selected class from all items
        document.querySelectorAll('.category-item').forEach(item => {
          item.classList.remove('selected');
        });
        // Add selected class to clicked item
        div.classList.add('selected');
        
        // Get random activity from selected category
        const activities = activitiesByCat[category];
        const randomActivity = activities[Math.floor(Math.random() * activities.length)];
        promptText.textContent = randomActivity;
      };
      
      catsList.appendChild(div);
    });

    popupCats.style.display = "flex";
    gsap.from(popupCats, {
      opacity: 0,
      scale: 0.8,
      duration: 0.5,
      ease: "back.out(1.7)"
    });
  }

  gotoPrompt.onclick = () => {
    gsap.to(popupLogro, {
      opacity: 0,
      scale: 0.8,
      duration: 0.3,
      ease: "power2.in",
      onComplete: () => {
        popupLogro.style.display = "none";
        showCategoryPopup();
      }
    });
  };

  // Add event listener for category selection
  document.addEventListener('click', (e) => {
    if (e.target.closest('.category-item')) {
      const selectedCategory = e.target.closest('.category-item');
      if (selectedCategory.classList.contains('selected')) {
        gsap.to(popupCats, {
          opacity: 0,
          scale: 0.8,
          duration: 0.3,
          ease: "power2.in",
          onComplete: () => {
            popupCats.style.display = "none";
            focusSect.style.display = "none";
            promptSect.style.display = "flex";
            gsap.from(promptSect, {
              opacity: 0,
              y: 20,
              duration: 0.5,
              ease: "power2.out"
            });
          }
        });
      }
    }
  });

  // Add event listener for "dame otra idea" button
  anotherIdea.onclick = () => {
    const selectedCategory = document.querySelector('.category-item.selected');
    if (selectedCategory) {
      const categoryName = selectedCategory.querySelector('span').textContent;
      const activities = activitiesByCat[categoryName];
      if (activities && activities.length > 0) {
        // Get a new random activity from the same category
        const newActivity = activities[Math.floor(Math.random() * activities.length)];
        
        // Animate the text change
        gsap.to(promptText, {
          opacity: 0,
          duration: 0.3,
          ease: "power2.inOut",
          onComplete: () => {
            promptText.textContent = newActivity;
            gsap.to(promptText, {
              opacity: 1,
              duration: 0.3,
              ease: "power2.inOut"
            });
          }
        });
      }
    }
  };

  // Add event listener for start activity button
  startActivityBtn.onclick = () => {
    // Start rest timer
    isRestTimer = true;
    duration = restMins * 60;
    remaining = duration;
    update();
    updateVisualMode(true);
    
    // Reset mask position for new timer
    gsap.set(maskRect, { attr: { y: 300 } });
    
    // Hide prompt and show timer
    gsap.to(promptSect, {
      opacity: 0,
      y: -20,
      duration: 0.3,
      ease: "power2.in",
      onComplete: () => {
        promptSect.style.display = "none";
        focusSect.style.display = "flex";
        startClock();
      }
    });
  };

  // 0. Mapa de actividades por categoría
const activitiesByCat = {
  "Creatividad": [
    "Dibuja tu día como un cómic",
    "Escribe un mini-poema sobre tu color favorito",
    "Crea un logo rápido para un café imaginario"
  ],
  "Movimiento Suave": [
    "Haz 5 estiramientos de cuello",
    "Camina en tu sitio 1 minuto con los ojos cerrados",
    "Gira suavemente los hombros 10 veces"
  ],
  "Escritura": [
    "Redacta un agradecimiento a alguien cercano",
    "Escribe una micro-historia de 50 palabras",
    "Anota tres ideas para mejorar tu espacio"
  ],
  "Autocuidado": [
    "Toma 3 respiraciones profundas",
    "Aplica una mascarilla rápida en cara o manos",
    "Escribe 3 cosas buenas que has hecho hoy"
  ],
  "Respira": [
    "Haz 4-7-8: inhala 4s, retén 7s, exhala 8s (x3)",
    "Coloca una mano en el pecho y otra en el vientre, siente tu respiración",
    "Cierra los ojos y respira contando mentalmente 10 veces"
  ],
  "Sorprendeme": [
    "Mira por la ventana 2 minutos sin pensar",
    "Escucha tu canción favorita en silencio",
    "Busca un objeto a tu alrededor y obsérvalo con detalle"
  ]
};

  // 9. Init
  update();

  // Initialize with focus mode colors
  updateVisualMode(false);

  // Update pause button click handler
  pauseBtn.onclick = () => {
    pauseClock();
    updateVisualMode(isRestTimer, true);
  };

  // Update play button click handler
  playBtn.onclick = () => {
    startClock();
    updateVisualMode(isRestTimer, false);
  };
});
